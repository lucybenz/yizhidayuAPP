<extend name="Common:app"/>

<block name='pageheader'>
<section class="content-header">
	<h1>
        添加活动
		<!--<small>Optional description</small>-->
	</h1>
	<ol class="breadcrumb">
		<li>
			<a href="{:U('Index/index')}">
				<i class="fa fa-dashboard">
				</i> 首页
			</a>
		</li>
		<li class="active">
			添加活动
		</li>
	</ol>
</section>
</block>

<block name='content'>
<div class="box">
	<div class="box-header">

	</div><!-- /.box-header -->

	<div class="box-body" >
		<div  class="">
			<div class="row">
				<div class="col-sm-8 col-sm-offset-1">


<form class="form-horizontal" method="post" action="{:U('Active/active_addstore')}"  enctype="multipart/form-data">
                  <div class="box-body">
                  	<div class="form-group">
                      <label for="inputPassword3" class="col-sm-2 control-label" title="必填">权重 <span id=""  style="color: red;">
                      	*
                      </span></label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" value="0" id="weight" name="weight" placeholder="">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="inputEmail3" class="col-sm-2 control-label" title="必填">活动icon <span id=""  style="color: red;">
                      	*
                      </span> </label>
                        <div class="col-sm-10" style="width:100px;height:100px;border:1px solid #ccc;position:relative;">
                            <input type="hidden" value="{$list.id}" name="id" id="id">
                            <input style="width:100px;height:100px;position:absolute;top:0;left:0;opacity: 0;z-index:5;" type="file" class="form-control" name="icon" id="inputEmail3" placeholder="">
                            <input id="imgurl" type="hidden" class="form-control" name="imgurl" value="" placeholder="">
                            <img id="img" style="width:100px;height:100px;position:absolute;top:0;left:0;" src="" alt="">
                        </div>
                    </div>

                      <div class="form-group">
                          <label for="inputEmail3" class="col-sm-2 control-label" title="必填">活动banner <span id=""  style="color: red;">
                      	*
                      </span> </label>
                          <div class="col-sm-10" style="width:100px;height:100px;border:1px solid #ccc;position:relative;">
                              <input type="hidden" value="{$list.id}" name="id" id="id2">
                              <input style="width:100px;height:100px;position:absolute;top:0;left:0;opacity: 0;z-index:5;" type="file" class="form-control" name="pic" id="inputEmail5" placeholder="">
                              <input id="imgurl2"  type="hidden" class="form-control" name="imgurl2" value="" placeholder="">
                              <img id="img2" style="width:100px;height:100px;position:absolute;top:0;left:0;" src="" alt="">
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="inputPassword3" class="col-sm-2 control-label" title="必填">活动名称 <span id=""  style="color: red;">
                      	*
                      </span></label>
                          <div class="col-sm-10">
                              <input type="text" class="form-control"value=""  name="title"  id="title" placeholder="例：星巴克转盘">
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="inputPassword3" class="col-sm-2 control-label" title="必填">活动模板名 <span id=""  style="color: red;">
                      	*
                      </span></label>
                          <div class="col-sm-10">
                              <input type="text" class="form-control" id="temp" name="temp"  placeholder="例：01_draw_star">
                              <div class="tip">将指向服务器文件名模板</div>
                          </div>
                      </div>
                      <div class="form-group">
                      <label for="inputPassword3" class="col-sm-2 control-label" title="必填">活动次数 <span id=""  style="color: red;">
                      	*
                      </span></label>
                      <div class="col-sm-10">
                          <input type="text" class="form-control" value="8" id="times" name='times' placeholder="请输入活动次数">
                      </div>
                  </div>

                      <div class="form-group">
                          <label for="inputPassword3" class="col-sm-2 control-label" title="必填">转化临界点 <span id=""  style="color: red;">
                      	*
                      </span></label>
                          <div class="col-sm-10">
                              <input  type="text" class="form-control"value="" id="determine" name="determine"  placeholder="例：3000">
                              <div class="tip">参与人数达到值后，自动转为老活动</div>
                          </div>
                      </div>

                      <div class="form-group">
                          <label for="inputPassword3" class="col-sm-2 control-label">是否上架:</label>
                          <div class="col-sm-10">
                              <input type="radio" name="status" value="2" ><label for="">上架</label>
                              <input type="radio" name="status" value="1"><label for="">下架</label>
                          </div>
                      </div>

                  </div><!-- /.box-body -->
                  <div class="box-footer">
                    <button type="submit" class="btn btn-info pull-right">保存</button>
                  </div><!-- /.box-footer -->
                </form>

				</div>
			</div>

		</div>
	</div><!-- /.box-body -->
</div>
</block>

<block name="js">
    <script src="{:C('PUBLIC')}/adminlte/plugins/datepicker/bootstrap-datepicker.js" type="text/javascript" charset="utf-8"></script>
    <script src="{:C('PUBLIC')}/adminlte/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js" type="text/javascript" charset="utf-8"></script>

    <script>

        var url ="{:U('Active/changepic')}";
        var file;
        $("input[name='icon']").change(function(){
            file = this.files[0];
            console.log(file);
            var formdata=new FormData();
            formdata.append('file',file);
            var ajax=new XMLHttpRequest();
            ajax.onload=function(){
                var headimg=ajax.responseText;
                console.log(headimg);
                var photo=document.querySelector('#img');
                $(photo).attr("src",headimg);
                $("#imgurl").attr("value",headimg);
            };
            ajax.open('post',url);
            ajax.send(formdata);
        })
        $("input[name='pic']").change(function(){
            file = this.files[0];
            console.log(file);
            var formdata=new FormData();
            formdata.append('file',file);
            var ajax=new XMLHttpRequest();
            ajax.onload=function(){
                var headimg=ajax.responseText;
                console.log(headimg);
                var photo=document.querySelector('#img2');
                $(photo).attr("src",headimg);
                $("#imgurl2").attr("value",headimg);
            };
            ajax.open('post',url);
            ajax.send(formdata);
        })


        $("#m").change(function(){
            var id=$(this).children('option:selected').val();
            console.log(id);
            $.ajax({
                url:"{:U('coupon/cateajax')}",
                dataType:"json",
                data:{id:id},
                type:"post",
                success:function(data){
                    if(data.status=="2"){
                        $("#m2").hide();
                    }else{
                        $("#m2").children().remove();
                        $("#m2").show();
                        for (var i=0;i<data.length;i++){
                            $(`<option value="${data[i].id}">${data[i].title}</option>`).appendTo($('#m2'));
                        }
                    }
                }
            })
        });


        $('#datepicker').datepicker({
            language: 'zh-CN',
            autoclose: true
        });
    </script>
</block>

